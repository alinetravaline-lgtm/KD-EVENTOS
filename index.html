<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KD EVENTOS | Conexões Reais</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f9ff; /* Cor mais clara da paleta */ }
        h1, h2, h3, .font-serif { font-family: 'Playfair Display', serif; }
        
        /* Utility */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #88cbff; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #93d0ff; }

        /* CHAT WIDGET STYLES (Fixed Z-Index) */
        .chat-widget { 
            position: fixed; 
            bottom: 25px; 
            right: 25px; 
            z-index: 9999; /* Highest priority */
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .chat-button { 
            height: 60px; 
            padding: 0 20px;
            border-radius: 30px; 
            /* Gradiente usando a paleta de azuis */
            background: linear-gradient(135deg, #88cbff, #9fd5ff);
            color: #1e293b; /* Texto escuro para contraste */
            display: flex; 
            align-items: center; 
            justify-content: center;
            gap: 8px;
            font-weight: 700;
            box-shadow: 0 4px 20px rgba(136, 203, 255, 0.5); 
            cursor: pointer; 
            transition: all 0.2s ease;
            border: 2px solid white;
        }
        .chat-button:hover { transform: scale(1.05); }
        
        .chat-window {
            width: 350px; 
            height: 450px;
            background: white; 
            border-radius: 16px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            display: none; /* Hidden by default */
            flex-direction: column; 
            overflow: hidden; 
            margin-bottom: 15px;
            border: 1px solid #cfeaff;
            animation: slideUp 0.3s ease;
        }
        .chat-window.open { display: flex; }
        
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .chat-messages { flex: 1; overflow-y: auto; padding: 16px; background: #f3f9ff; }
        .message { margin-bottom: 12px; max-width: 85%; padding: 10px 14px; border-radius: 12px; font-size: 0.9rem; line-height: 1.4; }
        
        /* User message now darker blue from text */
        .message.user { background: #88cbff; color: #0f172a; align-self: flex-end; margin-left: auto; border-bottom-right-radius: 2px; font-weight: 500; }
        .message.ai { background: white; color: #334155; align-self: flex-start; border: 1px solid #e7f4ff; border-bottom-left-radius: 2px; }
        
        /* Markdown styles in chat */
        .message.ai p { margin-bottom: 8px; }
        .message.ai ul { list-style-type: disc; margin-left: 20px; margin-bottom: 8px; }
        .message.ai strong { color: #0369a1; }

        /* AI Button in Modal */
        .ai-magic-btn {
            background: linear-gradient(90deg, #88cbff, #93d0ff);
            color: #0f172a;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: opacity 0.2s;
            box-shadow: 0 2px 10px rgba(136, 203, 255, 0.4);
        }
        .ai-magic-btn:hover { opacity: 0.9; }
    </style>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            primary: '#88cbff',   // Cor Primária (Azul Céu)
                            secondary: '#dafff1', // Cor Secundária (Menta)
                            surface: '#f3f9ff',   // Fundo (Azul muito claro)
                            text: '#0f172a',      // Texto Escuro (Slate 900) para contraste
                            accent: '#0284c7'     // Azul mais forte para textos/links
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="flex flex-col min-h-screen relative text-slate-800">

    <!-- Navigation -->
    <nav class="bg-white border-b border-brand-primary/20 sticky top-0 z-40 px-4 py-3 shadow-sm">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center cursor-pointer group" onclick="app.router('home')">
                <div class="bg-brand-secondary p-2 rounded-lg mr-2 group-hover:bg-brand-primary group-hover:scale-105 transition duration-300">
                    <i class="ph ph-confetti text-brand-text text-2xl"></i>
                </div>
                <span class="text-xl font-bold text-brand-text tracking-tight font-serif">KD EVENTOS</span>
            </div>
            
            <div class="hidden md:flex items-center space-x-6">
                <button onclick="app.router('home')" class="text-sm font-medium text-gray-600 hover:text-brand-accent transition">Buscar</button>
                <button onclick="app.router('search')" class="text-sm font-medium text-gray-600 hover:text-brand-accent transition">Explorar</button>
            </div>

            <div class="flex items-center space-x-3" id="auth-buttons">
                <!-- Injected via JS -->
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <main id="app-container" class="flex-grow">
        <!-- Views will be injected here -->
    </main>

    <!-- Footer -->
    <footer class="bg-brand-primary text-brand-text py-12 mt-auto border-t border-brand-primary">
        <div class="max-w-6xl mx-auto px-4 grid grid-cols-1 md:grid-cols-4 gap-8">
            <div>
                <div class="flex items-center mb-4">
                    <i class="ph ph-confetti text-white text-2xl mr-2 drop-shadow-sm"></i>
                    <span class="text-xl font-bold font-serif">KD EVENTOS</span>
                </div>
                <p class="text-slate-800 font-medium text-sm">Conectando sonhos aos melhores realizadores.</p>
            </div>
        </div>
    </footer>

    <!-- CHAT WIDGET (AI ASSISTANT) -->
    <div class="chat-widget">
        <div class="chat-window" id="chat-window">
            <div class="bg-brand-primary text-brand-text p-4 flex justify-between items-center border-b border-brand-primary/20">
                <div class="flex items-center gap-2">
                    <i class="ph ph-sparkle text-white text-xl drop-shadow-sm"></i>
                    <div>
                        <div class="font-bold font-serif leading-none">Assistente KD</div>
                        <div class="text-[10px] text-slate-700 uppercase tracking-wider font-semibold">Powered by Gemini AI</div>
                    </div>
                </div>
                <button onclick="app.toggleChat()" class="text-slate-700 hover:text-white transition"><i class="ph ph-x"></i></button>
            </div>
            <div class="chat-messages" id="chat-messages">
                <div class="message ai">
                    Olá! Sou a IA do KD Eventos. ✨<br>Posso ajudar com ideias, check-lists ou encontrar fornecedores. Como posso ajudar hoje?
                </div>
            </div>
            <form onsubmit="app.handleChatSubmit(event)" class="p-3 bg-white border-t border-gray-100 flex gap-2">
                <input type="text" id="chat-input" placeholder="Digite sua dúvida..." class="flex-1 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-brand-primary transition">
                <button type="submit" class="bg-brand-primary text-slate-800 rounded-lg w-10 h-10 flex items-center justify-center hover:bg-brand-secondary transition shadow-sm"><i class="ph ph-paper-plane-right font-bold"></i></button>
            </form>
        </div>
        
        <div class="chat-button" onclick="app.toggleChat()">
            <i class="ph ph-chat-teardrop-dots text-2xl"></i>
            <span>Chat IA</span>
        </div>
    </div>

    <!-- Modals Container -->
    <div id="modal-container"></div>

    <!-- Templates -->
    <template id="view-home">
        <!-- Alterado para gradiente suave entre a cor primária e tons da paleta -->
        <div class="bg-gradient-to-br from-brand-primary via-[#93d0ff] to-brand-secondary py-20 px-4 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-full opacity-30 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] mix-blend-overlay"></div>
            <div class="max-w-4xl mx-auto text-center relative z-10 fade-in">
                <span class="inline-block py-1 px-3 rounded-full bg-white/60 text-slate-800 text-xs font-bold mb-4 border border-white/50 backdrop-blur-sm shadow-sm">PLATAFORMA Nº1 DE CONEXÃO</span>
                
                <!-- Cor do texto ajustada para Slate-900 e Brand-Accent para melhor contraste no gradiente -->
                <h1 class="text-4xl md:text-5xl font-bold mb-6 leading-tight text-slate-900">
                    Eventos não começam no dia. <br/>
                    <span class="text-brand-accent drop-shadow-sm">Começam na conexão certa.</span>
                </h1>
                
                <!-- Barra de busca com efeito glassmorphism -->
                <div class="bg-white/90 backdrop-blur-md p-2 rounded-xl shadow-xl flex flex-col md:flex-row gap-2 max-w-3xl mx-auto border border-white/50">
                    <select id="home-city" class="flex-1 p-3 bg-transparent text-gray-800 outline-none border-b md:border-b-0 md:border-r border-gray-200 cursor-pointer hover:bg-gray-50/50 transition">
                        <option value="">Onde será o evento?</option>
                    </select>
                    <select id="home-category" class="flex-1 p-3 bg-transparent text-gray-800 outline-none cursor-pointer hover:bg-gray-50/50 transition">
                        <option value="">O que você precisa?</option>
                    </select>
                    <button onclick="app.handleHomeSearch()" class="bg-slate-900 hover:bg-slate-800 text-white font-bold py-3 px-8 rounded-lg transition shadow-lg transform hover:-translate-y-0.5">Buscar</button>
                </div>
            </div>
        </div>
        <div class="max-w-6xl mx-auto px-4 py-16">
            
            <!-- NOVOS BOTÕES DE AÇÃO -->
            <div class="flex flex-col md:flex-row justify-center gap-6 mb-16 -mt-24 relative z-20">
                <!-- Botão para Profissionais/Parceiros -->
                <button onclick="app.openAuthModal()" class="flex items-center justify-center gap-4 bg-white border border-gray-100 text-slate-800 px-8 py-5 rounded-2xl shadow-xl hover:shadow-2xl hover:border-brand-primary transition transform hover:-translate-y-1 group min-w-[280px]">
                    <div class="bg-brand-surface p-3 rounded-xl group-hover:bg-brand-primary transition duration-300">
                        <i class="ph ph-briefcase text-3xl text-brand-text"></i>
                    </div>
                    <div class="text-left">
                        <div class="text-xs text-gray-500 font-bold uppercase tracking-wider mb-1">Para Profissionais</div>
                        <div class="font-bold text-xl text-slate-900">Novos Parceiros</div>
                    </div>
                </button>

                <!-- Botão para Clientes Finais -->
                <button onclick="window.scrollTo({top: 0, behavior: 'smooth'}); setTimeout(() => document.getElementById('home-category').focus(), 500);" class="flex items-center justify-center gap-4 bg-slate-900 text-white px-8 py-5 rounded-2xl shadow-xl hover:shadow-2xl hover:bg-slate-800 transition transform hover:-translate-y-1 group min-w-[280px]">
                    <div class="bg-white/10 p-3 rounded-xl group-hover:bg-white/20 transition duration-300">
                        <i class="ph ph-confetti text-3xl text-brand-secondary"></i>
                    </div>
                    <div class="text-left">
                        <div class="text-xs text-gray-400 font-bold uppercase tracking-wider mb-1">Para Clientes</div>
                        <div class="font-bold text-xl">Planejar Evento</div>
                    </div>
                </button>
            </div>

            <h2 class="text-2xl font-bold font-serif mb-8 text-center text-slate-800">Categorias Populares</h2>
            <div id="home-categories-grid" class="grid grid-cols-2 md:grid-cols-6 gap-4 mb-20"></div>
            <h2 class="text-2xl font-bold font-serif text-slate-800 mb-6">Destaques da Semana</h2>
            <div id="home-featured-grid" class="grid grid-cols-1 md:grid-cols-4 gap-6"></div>
        </div>
    </template>

    <template id="view-search">
        <div class="max-w-6xl mx-auto px-4 py-8 fade-in">
            <div class="flex items-center space-x-2 mb-8 text-sm text-gray-500">
                <span onclick="app.router('home')" class="cursor-pointer hover:text-brand-accent">Home</span>
                <i class="ph ph-caret-right"></i>
                <span class="font-semibold text-slate-800">Resultados</span>
            </div>
            <div class="flex flex-col md:flex-row gap-8">
                <div class="w-full md:w-64 shrink-0">
                    <div class="bg-white p-6 rounded-xl border border-gray-200 sticky top-24 shadow-sm">
                        <h3 class="font-bold mb-4 text-slate-800">Filtrar</h3>
                        <div class="mb-4">
                            <label class="text-xs font-bold text-gray-400 uppercase mb-2 block">Cidade</label>
                            <select id="search-city" onchange="app.filterSearch()" class="w-full p-2 border rounded bg-brand-surface text-sm mb-4 outline-none focus:border-brand-primary"></select>
                            <label class="text-xs font-bold text-gray-400 uppercase mb-2 block">Categoria</label>
                            <select id="search-category" onchange="app.filterSearch()" class="w-full p-2 border rounded bg-brand-surface text-sm outline-none focus:border-brand-primary"></select>
                        </div>
                    </div>
                </div>
                <div class="flex-1">
                    <h2 class="text-2xl font-serif font-bold mb-2 text-slate-800"><span id="result-count" class="text-brand-accent">0</span> Resultados encontrados</h2>
                    <div id="search-results-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6"></div>
                </div>
            </div>
        </div>
    </template>

    <template id="view-profile">
        <div class="fade-in pb-12">
            <div class="max-w-6xl mx-auto px-4 py-4">
                <button onclick="app.router('search')" class="flex items-center text-gray-500 hover:text-brand-accent transition">
                    <i class="ph ph-arrow-left mr-2"></i> Voltar para busca
                </button>
            </div>
            <div class="h-64 md:h-80 w-full relative">
                <img id="profile-img" src="" class="w-full h-full object-cover" />
                <div class="absolute inset-0 bg-gradient-to-t from-slate-900/80 to-transparent"></div>
                <div class="absolute bottom-0 left-0 w-full p-6 md:p-10 text-white max-w-6xl mx-auto">
                    <div class="flex items-center gap-2 mb-2">
                        <span id="profile-cat" class="bg-brand-primary text-slate-900 px-2 py-0.5 rounded text-xs font-bold uppercase shadow-sm"></span>
                        <span id="profile-verified" class="bg-white text-brand-accent px-2 py-0.5 rounded text-xs font-bold flex items-center hidden"><i class="ph ph-seal-check mr-1"></i> Verificado</span>
                    </div>
                    <h1 id="profile-name" class="text-3xl md:text-5xl font-bold font-serif mb-2 text-white"></h1>
                    <div class="flex items-center text-gray-200">
                        <i class="ph ph-map-pin mr-1"></i> <span id="profile-city"></span>
                        <span class="mx-2">•</span>
                        <i class="ph ph-star-fill text-brand-primary mr-1"></i> <span id="profile-rating"></span>
                    </div>
                </div>
            </div>
            <div class="max-w-6xl mx-auto px-4 mt-8 grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="md:col-span-2 space-y-8">
                    <section class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">Sobre</h2>
                        <p id="profile-desc" class="text-gray-600 leading-relaxed"></p>
                    </section>
                    <section class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">Diferenciais</h2>
                        <div id="profile-features" class="grid grid-cols-2 gap-4"></div>
                    </section>
                </div>
                <div class="md:col-span-1">
                    <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-lg sticky top-24">
                        <div class="text-center mb-6">
                            <p class="text-gray-500 text-sm">Preço estimado</p>
                            <div id="profile-price" class="text-2xl font-bold text-slate-800"></div>
                        </div>
                        <button onclick="app.openQuoteModal()" class="w-full bg-brand-primary hover:bg-sky-400 text-slate-900 font-bold py-3 rounded-lg mb-3 shadow-lg shadow-brand-primary/30 transition transform active:scale-95">Solicitar Orçamento</button>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="view-dashboard">
        <div class="max-w-6xl mx-auto px-4 py-8 fade-in">
            <h1 class="text-3xl font-bold text-slate-800 mb-6">Dashboard do Fornecedor</h1>
            <div id="dash-leads-list" class="bg-white rounded-xl shadow-sm border border-gray-100 p-6"></div>
        </div>
    </template>

    <!-- JS Application Logic -->
    <script>
        const apiKey = ""; // API Key injected by runtime
        const CITIES = ["São Paulo", "Rio de Janeiro", "Curitiba", "Belo Horizonte", "Brasília"];
        const CATEGORIES = ["Espaços", "Fotografia", "Buffet", "Música & DJ", "Decoração", "Assessoria"];
        
        const INITIAL_SUPPLIERS = [
            { id: 1, name: "Villa Toscana Eventos", category: "Espaços", city: "São Paulo", rating: 4.9, reviews: 128, verified: true, premium: true, price: "Alto", description: "Um pedaço da Itália em SP. Perfeito para casamentos e eventos corporativos de alto nível.", image: "https://images.unsplash.com/photo-1519167758481-83f550bb49b3?auto=format&fit=crop&q=80&w=800", features: ["Ar Livre", "Gerador Próprio", "Estacionamento"] },
            { id: 2, name: "Luz & Arte Fotografia", category: "Fotografia", city: "Rio de Janeiro", rating: 4.8, reviews: 84, verified: true, premium: false, price: "Médio", description: "Capturando a essência de cada momento com um olhar artístico e sensível.", image: "https://images.unsplash.com/photo-1537905569824-f89f14cceb68?auto=format&fit=crop&q=80&w=800", features: ["Drone 4K", "Álbum Digital", "Same Day Edit"] },
            { id: 3, name: "Sabor & Requinte", category: "Buffet", city: "Curitiba", rating: 4.7, reviews: 56, verified: false, premium: false, price: "Médio", description: "Gastronomia contemporânea que encanta pelo paladar e pela apresentação.", image: "https://images.unsplash.com/photo-1555244162-803834f70033?auto=format&fit=crop&q=80&w=800", features: ["Menu Vegano", "Degustação"] }
        ];

        // --- GEMINI API HELPER ---
        async function callGemini(prompt, systemInstruction = "") {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] }
            };

            const delays = [1000, 2000, 4000];
            for (let i = 0; i <= delays.length; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) throw new Error(`API Error: ${response.status}`);
                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text || "Desculpe, não consegui processar isso agora.";
                } catch (error) {
                    if (i === delays.length) return "Erro de conexão com a IA. Verifique sua chave de API ou tente mais tarde.";
                    await new Promise(r => setTimeout(r, delays[i]));
                }
            }
        }

        // --- APP CONTROLLER ---
        const app = {
            data: {
                suppliers: [...INITIAL_SUPPLIERS],
                leads: [],
                currentUser: null,
                currentView: 'home',
                searchFilters: { city: '', category: '' },
                selectedSupplierId: null,
                isChatOpen: false
            },

            init: () => {
                app.router('home');
                app.updateAuthUI();
                
                // Close chat on click outside
                document.addEventListener('click', (e) => {
                    const widget = document.querySelector('.chat-widget');
                    const btn = document.querySelector('.chat-button');
                    const win = document.querySelector('.chat-window');
                    
                    if(app.data.isChatOpen && !win.contains(e.target) && !btn.contains(e.target)) {
                        app.toggleChat();
                    }
                });
            },

            router: (viewName) => {
                app.data.currentView = viewName;
                const container = document.getElementById('app-container');
                container.innerHTML = ''; 
                const template = document.getElementById(`view-${viewName}`);
                if(template) {
                    container.appendChild(template.content.cloneNode(true));
                }

                if(viewName === 'home') app.initHome();
                if(viewName === 'search') app.initSearch();
                if(viewName === 'profile') app.initProfile();
                if(viewName === 'dashboard') app.initDashboard();
                window.scrollTo(0,0);
            },

            // --- CHAT LOGIC ---
            toggleChat: () => {
                app.data.isChatOpen = !app.data.isChatOpen;
                const win = document.getElementById('chat-window');
                win.classList.toggle('open');
                if(app.data.isChatOpen) setTimeout(() => document.getElementById('chat-input').focus(), 100);
            },

            handleChatSubmit: async (e) => {
                e.preventDefault();
                const input = document.getElementById('chat-input');
                const text = input.value.trim();
                if(!text) return;

                const msgs = document.getElementById('chat-messages');
                msgs.innerHTML += `<div class="message user">${text}</div>`;
                input.value = '';
                msgs.scrollTop = msgs.scrollHeight;

                const loadingId = 'loading-' + Date.now();
                msgs.innerHTML += `<div id="${loadingId}" class="message ai">...</div>`;
                msgs.scrollTop = msgs.scrollHeight;

                const systemPrompt = "Você é o Assistente Virtual da plataforma KD Eventos. Ajude com planejamento, ideias e dúvidas. Seja amigável, conciso e use emojis.";
                const response = await callGemini(text, systemPrompt);

                document.getElementById(loadingId).remove();
                
                // Parse markdown if available, else plain text
                const formatted = typeof marked !== 'undefined' ? marked.parse(response) : response;
                
                msgs.innerHTML += `<div class="message ai">${formatted}</div>`;
                msgs.scrollTop = msgs.scrollHeight;
            },

            // --- QUOTE LOGIC WITH AI ---
            openQuoteModal: () => {
                const modal = document.createElement('div');
                modal.className = "fixed inset-0 bg-slate-900/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm";
                modal.innerHTML = `
                    <div class="bg-white rounded-2xl w-full max-w-md p-6 relative fade-in shadow-2xl">
                        <button onclick="this.closest('.fixed').remove()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i class="ph ph-x text-xl"></i></button>
                        <h3 class="text-2xl font-bold font-serif text-slate-800 mb-2">Pedir Orçamento</h3>
                        <p class="text-sm text-gray-500 mb-6">Grátis e sem compromisso.</p>
                        <form onsubmit="app.submitQuote(event)">
                            <div class="mb-3">
                                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Seu Nome</label>
                                <input id="quote-name" required name="name" class="w-full p-3 border border-gray-200 rounded-lg outline-none focus:border-brand-primary" placeholder="Ex: Maria Silva">
                            </div>
                            <div class="mb-3">
                                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Data do Evento</label>
                                <input id="quote-date" required name="date" type="date" class="w-full p-3 border border-gray-200 rounded-lg outline-none focus:border-brand-primary">
                            </div>
                            <div class="mb-3 relative">
                                <label class="block text-xs font-bold text-gray-500 uppercase mb-1 flex justify-between items-center">
                                    Mensagem
                                    <button id="ai-btn" type="button" onclick="app.generateQuoteMessage()" class="ai-magic-btn">
                                        <i class="ph ph-sparkle"></i> Escrever com IA
                                    </button>
                                </label>
                                <textarea id="quote-msg" required name="msg" class="w-full p-3 border border-gray-200 rounded-lg h-32 text-sm outline-none focus:border-brand-primary" placeholder="Descreva seu evento..."></textarea>
                            </div>
                            <button type="submit" class="w-full bg-brand-primary text-slate-900 font-bold py-3 rounded-lg hover:bg-brand-secondary transition">Enviar Pedido</button>
                        </form>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            generateQuoteMessage: async () => {
                const name = document.getElementById('quote-name').value;
                const date = document.getElementById('quote-date').value;
                const supplier = app.data.suppliers.find(s => s.id === app.data.selectedSupplierId);

                if(!name || !date) {
                    alert('Por favor, preencha seu nome e a data antes de usar a IA.');
                    return;
                }

                const btn = document.getElementById('ai-btn');
                const originalText = btn.innerHTML;
                btn.innerHTML = `<i class="ph ph-spinner animate-spin"></i> Gerando...`;
                btn.disabled = true;

                const prompt = `Escreva uma mensagem curta e cordial para solicitar orçamento. 
                Cliente: ${name}. Fornecedor: ${supplier.name} (${supplier.category}). 
                Data: ${date}. Contexto: Gostei do perfil no site e quero saber disponibilidade e valores.`;

                const response = await callGemini(prompt, "Você é um assistente pessoal. Gere apenas o texto da mensagem, sem aspas.");

                document.getElementById('quote-msg').value = response.trim();
                btn.innerHTML = originalText;
                btn.disabled = false;
            },

            submitQuote: (e) => {
                e.preventDefault();
                const form = e.target;
                const lead = {
                    id: Date.now(),
                    supplierId: app.data.selectedSupplierId,
                    name: form.name.value,
                    date: form.date.value,
                    message: form.msg.value
                };
                app.data.leads.push(lead);
                e.target.closest('.fixed').remove();
                alert('Orçamento enviado com sucesso! O fornecedor responderá em breve.');
            },

            // --- STANDARD VIEW LOGIC (Home, Search, etc.) ---
            initHome: () => {
                app.fillSelects('home-city', 'home-category');
                const catGrid = document.getElementById('home-categories-grid');
                CATEGORIES.forEach((cat, i) => {
                    const div = document.createElement('div');
                    div.className = "bg-white p-6 rounded-xl shadow-sm hover:shadow-md border border-gray-100 text-center cursor-pointer transition group hover:-translate-y-1";
                    div.innerHTML = `
                        <div class="bg-brand-secondary w-12 h-12 rounded-full mx-auto flex items-center justify-center mb-3 group-hover:bg-brand-primary transition">
                            <i class="ph ${i % 2 === 0 ? 'ph-camera' : 'ph-music-notes'} text-xl text-slate-700 group-hover:text-slate-900"></i>
                        </div>
                        <div class="font-semibold text-gray-700 text-sm">${cat}</div>
                    `;
                    div.onclick = () => { app.data.searchFilters.category = cat; app.router('search'); };
                    catGrid.appendChild(div);
                });
                const featGrid = document.getElementById('home-featured-grid');
                app.data.suppliers.slice(0, 4).forEach(s => {
                    featGrid.appendChild(app.createSupplierCard(s));
                });
            },

            handleHomeSearch: () => {
                app.data.searchFilters.city = document.getElementById('home-city').value;
                app.data.searchFilters.category = document.getElementById('home-category').value;
                app.router('search');
            },

            initSearch: () => {
                app.fillSelects('search-city', 'search-category');
                document.getElementById('search-city').value = app.data.searchFilters.city;
                document.getElementById('search-category').value = app.data.searchFilters.category;
                app.renderSearchResults();
            },

            filterSearch: () => {
                app.data.searchFilters.city = document.getElementById('search-city').value;
                app.data.searchFilters.category = document.getElementById('search-category').value;
                app.renderSearchResults();
            },

            renderSearchResults: () => {
                const grid = document.getElementById('search-results-grid');
                const countSpan = document.getElementById('result-count');
                grid.innerHTML = '';
                const filtered = app.data.suppliers.filter(s => {
                    const matchCity = app.data.searchFilters.city ? s.city === app.data.searchFilters.city : true;
                    const matchCat = app.data.searchFilters.category ? s.category === app.data.searchFilters.category : true;
                    return matchCity && matchCat;
                });
                countSpan.textContent = filtered.length;
                if(filtered.length === 0) {
                    grid.innerHTML = '<div class="col-span-3 text-center py-10 text-gray-400">Nenhum resultado encontrado com estes filtros.</div>';
                } else {
                    filtered.forEach(s => grid.appendChild(app.createSupplierCard(s)));
                }
            },

            initProfile: () => {
                const s = app.data.suppliers.find(x => x.id === app.data.selectedSupplierId);
                if(!s) return app.router('search');
                document.getElementById('profile-img').src = s.image;
                document.getElementById('profile-name').innerText = s.name;
                document.getElementById('profile-city').innerText = s.city;
                document.getElementById('profile-cat').innerText = s.category;
                document.getElementById('profile-rating').innerText = `${s.rating} (${s.reviews} avaliações)`;
                document.getElementById('profile-desc').innerText = s.description;
                document.getElementById('profile-price').innerText = s.price === "Alto" ? "$$$" : s.price === "Médio" ? "$$" : "$";
                if(s.verified) document.getElementById('profile-verified').classList.remove('hidden');
                const featuresDiv = document.getElementById('profile-features');
                s.features.forEach(f => featuresDiv.innerHTML += `<div class="flex items-center text-gray-700"><i class="ph ph-check text-brand-primary mr-2 text-xl font-bold"></i> ${f}</div>`);
            },

            initDashboard: () => {
                if(!app.data.currentUser) return app.router('home');
                const myLeads = app.data.leads.filter(l => l.supplierId === app.data.currentUser.supplierId);
                const list = document.getElementById('dash-leads-list');
                
                if(myLeads.length === 0) {
                    list.innerHTML = `<div class="text-center text-gray-400 py-10">Você ainda não recebeu nenhum orçamento.<br>Melhore seu perfil para atrair mais clientes!</div>`;
                } else {
                    list.innerHTML = `<div class="space-y-4">${myLeads.map(l => `
                        <div class="border-b border-gray-100 pb-4 last:border-0 hover:bg-gray-50 p-4 rounded transition">
                            <div class="flex justify-between items-start">
                                <div class="font-bold text-slate-800 text-lg">${l.name}</div>
                                <span class="bg-brand-secondary text-brand-text px-2 py-1 rounded text-xs font-bold">${l.date}</span>
                            </div>
                            <div class="text-gray-600 text-sm mt-2 bg-white border border-gray-100 p-3 rounded shadow-sm">"${l.message}"</div>
                            <div class="mt-3 flex gap-2">
                                <button class="text-xs bg-brand-primary text-slate-900 px-3 py-1 rounded hover:opacity-80">Responder</button>
                                <button class="text-xs border border-gray-300 text-gray-600 px-3 py-1 rounded hover:bg-gray-100">Arquivar</button>
                            </div>
                        </div>
                    `).join('')}</div>`;
                }
            },

            // --- AUTH & HELPERS ---
            openAuthModal: () => {
                const modal = document.createElement('div');
                modal.className = "fixed inset-0 bg-slate-900/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm";
                modal.innerHTML = `
                    <div class="bg-white rounded-2xl w-full max-w-md p-8 relative shadow-2xl fade-in">
                        <button onclick="this.closest('.fixed').remove()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i class="ph ph-x text-xl"></i></button>
                        <h3 class="text-2xl font-bold font-serif text-slate-800 text-center mb-6">Área do Fornecedor</h3>
                        <p class="text-center text-gray-500 mb-6 text-sm">Gerencie seu perfil e responda orçamentos.</p>
                        <button onclick="app.loginDemo()" class="w-full bg-brand-primary hover:bg-brand-secondary text-slate-900 font-bold py-3 rounded-lg mb-4 transition shadow-md">Entrar como Demo</button>
                    </div>
                `;
                document.body.appendChild(modal);
            },
            loginDemo: () => {
                app.data.currentUser = { name: "Fornecedor Demo", type: "supplier", supplierId: 1 };
                app.updateAuthUI();
                document.querySelector('.fixed').remove();
                app.router('dashboard');
            },
            logout: () => {
                app.data.currentUser = null;
                app.updateAuthUI();
                app.router('home');
            },
            updateAuthUI: () => {
                const container = document.getElementById('auth-buttons');
                if(app.data.currentUser) {
                    container.innerHTML = `<button onclick="app.router('dashboard')" class="text-sm font-bold text-slate-700 hover:text-brand-accent">Dashboard</button> <button onclick="app.logout()" class="text-sm text-red-500 font-medium hover:text-red-700">Sair</button>`;
                } else {
                    container.innerHTML = `<button onclick="app.openAuthModal()" class="bg-slate-900 text-white px-5 py-2 rounded-lg text-sm font-semibold hover:bg-slate-800 transition shadow-md">Sou Fornecedor</button>`;
                }
            },
            fillSelects: (cityId, catId) => {
                const citySel = document.getElementById(cityId);
                const catSel = document.getElementById(catId);
                if(!citySel || !catSel) return;
                
                while (citySel.options.length > 1) citySel.remove(1);
                while (catSel.options.length > 1) catSel.remove(1);
                CITIES.forEach(c => citySel.add(new Option(c, c)));
                CATEGORIES.forEach(c => catSel.add(new Option(c, c)));
            },
            createSupplierCard: (s) => {
                const el = document.createElement('div');
                el.className = "bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-lg transition cursor-pointer group";
                el.onclick = () => { app.data.selectedSupplierId = s.id; app.router('profile'); };
                el.innerHTML = `
                    <div class="relative h-48 overflow-hidden">
                        <img src="${s.image}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500" />
                        <div class="absolute bottom-3 right-3 bg-white/95 text-xs font-bold px-2 py-1 rounded shadow-sm text-slate-800">⭐ ${s.rating}</div>
                        ${s.premium ? '<div class="absolute top-3 left-3 bg-brand-primary text-slate-900 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Destaque</div>' : ''}
                    </div>
                    <div class="p-4">
                        <div class="text-xs font-bold text-brand-accent uppercase mb-1">${s.category}</div>
                        <h3 class="font-bold text-slate-800 text-lg leading-tight mb-1">${s.name}</h3>
                        <div class="text-gray-500 text-sm flex items-center"><i class="ph ph-map-pin mr-1"></i> ${s.city}</div>
                    </div>
                `;
                return el;
            }
        };

        document.addEventListener('DOMContentLoaded', app.init);
    </script>
</body>
</html>
